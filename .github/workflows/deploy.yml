      # 🔐 Secret-Key in Datei schreiben (ohne Passphrase!)
      - name: Write SSH key file
        run: |
          printf "%s\n" "${{ secrets.SSH_PRIVATE_KEY }}" > ga_key
          chmod 600 ga_key

      # ✅ Server-Hostkey lernen (IP)
      - name: Add server host key
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H 94.130.79.103 >> ~/.ssh/known_hosts

      # 🔍 Prüfen, welcher PUBLIC Key wirklich genutzt wird
      - name: Show public key derived from secret
        run: |
          ssh-keygen -y -f ga_key > pub_from_secret.pub
          echo "----- PUBLIC KEY (from secret) -----"
          cat pub_from_secret.pub
          echo "------------------------------------"

      # ✅ Kurztest mit GENAU diesem Key (ohne Agent)
      - name: Test SSH connection (forced key)
        run: ssh -o BatchMode=yes -o IdentitiesOnly=yes -i ga_key deploy@94.130.79.103 "echo ✅ SSH funktioniert"

      # 🚀 Deploy per rsync mit GENAU diesem Key
      - name: Rsync deploy
        run: |
          set -eo pipefail
          rsync -az --delete --mkpath \
            --no-perms --no-owner --no-group --omit-dir-times \
            -e "ssh -o IdentitiesOnly=yes -i ga_key -o ServerAliveInterval=30 -o ServerAliveCountMax=6" \
            dist/ deploy@94.130.79.103:/opt/site/public/
